# Story 2.3: ChatInterface å›æµ‹æµç¨‹é›†æˆ

## Status

**Completed** âœ…

---

## Story

**As a** äº¤æ˜“ç­–ç•¥ç”¨æˆ·,
**I want** åœ¨å¯¹è¯ç•Œé¢ä¸­å½“ AI å»ºè®®å›æµ‹æ—¶è‡ªåŠ¨å¼¹å‡ºå›æµ‹é¢æ¿,
**so that** æˆ‘å¯ä»¥æ— ç¼åœ°ä»ç­–ç•¥åˆ›å»ºæµç¨‹è¿‡æ¸¡åˆ°å›æµ‹éªŒè¯ï¼Œæ— éœ€æ‰‹åŠ¨åˆ‡æ¢ç•Œé¢ã€‚

---

## Acceptance Criteria

1. [x] ChatInterface è‡ªåŠ¨æ£€æµ‹ `run_backtest` action
2. [x] å¼¹å‡º BacktestCanvas å¹¶æ˜¾ç¤ºé…ç½®
3. [x] å›æµ‹å®Œæˆååœ¨å¯¹è¯ä¸­æ˜¾ç¤ºç»“æœæ‘˜è¦
4. [x] å›æµ‹é€šè¿‡åå¯ç”¨ Deploy æŒ‰é’®
5. [x] å›æµ‹å¤±è´¥åæ˜¾ç¤ºæ”¹è¿›å»ºè®®
6. [x] ä¸ DeployCanvas è”åŠ¨æ­£ç¡®
7. [x] TypeScript ç±»å‹å®‰å…¨æ£€æŸ¥é€šè¿‡

---

## Tasks / Subtasks

- [ ] **Task 1: ChatInterface çŠ¶æ€æ‰©å±•** (AC: 1, 2)
  - [ ] æ·»åŠ  `backtestOpen` çŠ¶æ€
  - [ ] æ·»åŠ  `backtestConfig` çŠ¶æ€
  - [ ] ä¿®æ”¹ `handleInsightAction` æ”¯æŒ `run_backtest`
  - [ ] æ¸²æŸ“ BacktestCanvas ç»„ä»¶

- [ ] **Task 2: useBacktest é›†æˆ** (AC: 2, 3)
  - [ ] åœ¨ ChatInterface ä¸­ä½¿ç”¨ useBacktest Hook
  - [ ] å®ç° `handleBacktestStart` æ–¹æ³•
  - [ ] å®ç° `handleBacktestComplete` æ–¹æ³•

- [ ] **Task 3: å¯¹è¯æ¶ˆæ¯åé¦ˆ** (AC: 3, 5)
  - [ ] å›æµ‹å®Œæˆæ·»åŠ ç»“æœæ‘˜è¦æ¶ˆæ¯
  - [ ] å›æµ‹å¤±è´¥æ·»åŠ é”™è¯¯æ¶ˆæ¯
  - [ ] æ˜¾ç¤ºæ”¹è¿›å»ºè®®

- [ ] **Task 4: DeployCanvas è”åŠ¨** (AC: 4, 6)
  - [ ] å›æµ‹é€šè¿‡åæ›´æ–° `backtestResult`
  - [ ] å¯ç”¨ Deploy æŒ‰é’®
  - [ ] éªŒè¯ Paper éƒ¨ç½²æµç¨‹

- [ ] **Task 5: TypeScript æ£€æŸ¥** (AC: 7)
  - [ ] ä¿®å¤æ‰€æœ‰ç±»å‹é”™è¯¯
  - [ ] ç¡®ä¿ç»„ä»¶æ¥å£æ­£ç¡®

---

## Dev Notes

### ChatInterface é›†æˆæµç¨‹

```
1. AI è¿”å› InsightData with actions: ['run_backtest']
   â†“
2. useEffect æ£€æµ‹ run_backtest action
   â†“
3. handleInsightAction è§¦å‘
   â†“
4. ä» InsightData æå–å›æµ‹é…ç½®
   â†“
5. setBacktestOpen(true) + setBacktestConfig(config)
   â†“
6. BacktestCanvas å¼¹å‡º
   â†“
7. ç”¨æˆ·ç¡®è®¤ â†’ useBacktest.startBacktest()
   â†“
8. å®æ—¶è¿›åº¦æ›´æ–° â†’ BacktestCanvas å±•ç¤º
   â†“
9. å®Œæˆ: æ·»åŠ ç»“æœæ¶ˆæ¯ + æ›´æ–° backtestResult
   â†“
10. å¦‚é€šè¿‡ â†’ å¯¹è¯ä¸­å¯è§¦å‘ deploy_paper
```

### ChatInterface çŠ¶æ€æ‰©å±•

```typescript
// ChatInterface.tsx æ–°å¢çŠ¶æ€

// å›æµ‹çŠ¶æ€
const [backtestOpen, setBacktestOpen] = useState(false)
const [backtestConfig, setBacktestConfig] = useState<BacktestConfig | null>(null)

// useBacktest Hook
const {
  state: backtestState,
  startBacktest,
  cancelBacktest,
  reset: resetBacktest,
} = useBacktest({
  strategyId: currentStrategyId,
  onSuccess: handleBacktestSuccess,
  onError: handleBacktestError,
})
```

### æ¶ˆæ¯åé¦ˆæ¨¡æ¿

```typescript
// å›æµ‹æˆåŠŸæ¶ˆæ¯
const successMessage = {
  role: 'assistant',
  content: `ğŸ‰ å›æµ‹å®Œæˆï¼ç­–ç•¥ "${strategyName}" è¡¨ç°å¦‚ä¸‹ï¼š

ğŸ“Š **å…³é”®æŒ‡æ ‡**
- æ€»æ”¶ç›Šç‡: ${metrics.totalReturn.toFixed(2)}%
- å¹´åŒ–æ”¶ç›Šç‡: ${metrics.annualizedReturn.toFixed(2)}%
- æœ€å¤§å›æ’¤: ${metrics.maxDrawdown.toFixed(2)}%
- å¤æ™®æ¯”ç‡: ${metrics.sharpeRatio.toFixed(2)}
- èƒœç‡: ${metrics.winRate.toFixed(2)}%

${passed ? 'âœ… ç­–ç•¥é€šè¿‡å›æµ‹éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œ Paper éƒ¨ç½²ã€‚' : 'âš ï¸ ç­–ç•¥æœªè¾¾åˆ°éƒ¨ç½²æ ‡å‡†ï¼Œå»ºè®®ä¼˜åŒ–å‚æ•°ã€‚'}`,
}
```

### æ–‡ä»¶è·¯å¾„

| æ–‡ä»¶ | è·¯å¾„ | æ“ä½œ |
|------|------|------|
| ChatInterface | `frontend/web-app/src/components/strategy/ChatInterface.tsx` | ä¿®æ”¹ |

---

## Dependencies

- Story 2.1: useBacktest Hook âœ…
- Story 2.2: å›æµ‹ API æ¥å£ âœ…
- EPIC-001: DeployCanvas ç»„ä»¶ âœ…

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-25 | 1.0 | åˆå§‹ Story åˆ›å»º | YOLO Agent |

