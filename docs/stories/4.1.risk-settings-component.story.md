# Story 4.1: 风险配置类型与 UI 组件

## Status

**Completed** ✅

---

## Story

**As a** 交易策略用户,
**I want** 在部署策略时配置止损止盈和仓位限制,
**so that** 我可以保护资金安全并控制风险敞口。

---

## Acceptance Criteria

1. [x] 创建 `types/risk.ts` 风险配置类型定义
2. [x] 创建 `components/canvas/RiskSettings.tsx` 组件
3. [x] 止损设置支持固定价格和百分比两种模式
4. [x] 止盈设置支持固定价格和百分比两种模式
5. [x] 仓位限制滑块控制 (0-100%)
6. [x] 显示风险评估摘要 (风险等级、最大损失、预期收益)
7. [x] TypeScript 类型安全检查通过

---

## Tasks / Subtasks

- [ ] **Task 1: 类型定义** (AC: 1)
  - [ ] 创建 `types/risk.ts`
  - [ ] 定义 StopLossConfig 接口
  - [ ] 定义 TakeProfitConfig 接口
  - [ ] 定义 PositionLimitConfig 接口
  - [ ] 定义 RiskSettings 接口
  - [ ] 定义 RiskLevel 类型
  - [ ] 导出默认值常量

- [ ] **Task 2: RiskSettings 组件** (AC: 2, 3, 4, 5)
  - [ ] 创建组件文件
  - [ ] 实现止损设置区块
  - [ ] 实现止盈设置区块
  - [ ] 实现仓位限制滑块
  - [ ] 实现切换开关 (Checkbox)
  - [ ] 实现类型切换 (固定价格/百分比)

- [ ] **Task 3: 风险评估显示** (AC: 6)
  - [ ] 计算风险等级
  - [ ] 计算最大可能损失
  - [ ] 计算最大预期收益
  - [ ] 计算风险收益比
  - [ ] 显示风险评估卡片

- [ ] **Task 4: TypeScript 检查** (AC: 7)
  - [ ] 修复所有类型错误
  - [ ] 确保组件接口正确

---

## Dev Notes

### 类型定义

```typescript
// types/risk.ts

export type RiskLevel = 'low' | 'medium' | 'high' | 'critical'

export interface StopLossConfig {
  enabled: boolean
  type: 'fixed_price' | 'percentage'
  value: number
}

export interface TakeProfitConfig {
  enabled: boolean
  type: 'fixed_price' | 'percentage'
  value: number
}

export interface PositionLimitConfig {
  maxPositionPercent: number  // 0-100
  maxTradeAmount: number
}

export interface RiskSettings {
  stopLoss: StopLossConfig
  takeProfit: TakeProfitConfig
  positionLimit: PositionLimitConfig
}

export const DEFAULT_RISK_SETTINGS: RiskSettings = {
  stopLoss: {
    enabled: true,
    type: 'percentage',
    value: 5,
  },
  takeProfit: {
    enabled: true,
    type: 'percentage',
    value: 15,
  },
  positionLimit: {
    maxPositionPercent: 20,
    maxTradeAmount: 10000,
  },
}
```

### 组件接口

```typescript
interface RiskSettingsProps {
  value: RiskSettings
  onChange: (settings: RiskSettings) => void
  currentPrice?: number
  totalCapital?: number
  disabled?: boolean
  className?: string
}
```

### 文件路径

| 文件 | 路径 | 操作 |
|------|------|------|
| Risk Types | `frontend/web-app/src/types/risk.ts` | 创建 |
| RiskSettings | `frontend/web-app/src/components/canvas/RiskSettings.tsx` | 创建 |

---

## Dependencies

- Shadcn/ui: Checkbox, Slider (需确认是否已有)
- HeatmapSlider 组件 (可复用)
- cn 工具函数

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-25 | 1.0 | 初始 Story 创建 | YOLO Agent |

