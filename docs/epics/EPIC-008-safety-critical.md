# Epic 008: å®‰å…¨å…³é”®åŠŸèƒ½ - Brownfield Enhancement

> åŸºäº V3 è®¾è®¡æ–‡æ¡£åœºæ™¯ S28/S30/S31ï¼Œå®ç°äº¤æ˜“å®‰å…¨çš„æ ¸å¿ƒä¿æŠ¤æœºåˆ¶

---

## Epic å…ƒæ•°æ®

| å±æ€§ | å€¼ |
|------|-----|
| Epic ID | EPIC-008 |
| åç§° | å®‰å…¨å…³é”®åŠŸèƒ½ (Safety Critical Features) |
| ç±»å‹ | Brownfield Enhancement |
| ä¼˜å…ˆçº§ | P0 (å®‰å…¨å…³é”® - Live éƒ¨ç½²å‰å¿…é¡»å®Œæˆ) |
| é¢„ä¼° Stories | 4 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-26 |
| V3 è®¾è®¡å‚è€ƒ | `S28 ä¿è¯é‡‘/å¼ºå¹³é¢„è­¦`, `S30 Kill Switch`, `S31 å®¡æ‰¹æµç¨‹` |
| å‰ç½®ä¾èµ– | EPIC-001 âœ…, EPIC-004 âœ…, EPIC-006 ğŸ”„ |

---

## Epic Goal

**åœ¨ç”¨æˆ·è¿›è¡Œ Live äº¤æ˜“å‰ï¼Œç¡®ä¿ç³»ç»Ÿå…·å¤‡å®Œæ•´çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶ï¼Œé˜²æ­¢èµ„é‡‘æŸå¤±ã€‚**

æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **Kill Switch ç´§æ€¥åœæ­¢** - ä¸€é”®åœæ­¢æ‰€æœ‰äº¤æ˜“æ´»åŠ¨
2. **å®¡æ‰¹æµç¨‹** - Live éƒ¨ç½²å‰çš„å¤šçº§ç¡®è®¤æœºåˆ¶
3. **ä¿è¯é‡‘é¢„è­¦** - å®æ—¶ç›‘æ§å¼ºå¹³é£é™©
4. **ç†”æ–­æœºåˆ¶** - å¼‚å¸¸æƒ…å†µè‡ªåŠ¨åœæ­¢äº¤æ˜“

---

## ç°æœ‰ç³»ç»Ÿä¸Šä¸‹æ–‡

### å·²æœ‰ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| DeployCanvas | `components/canvas/DeployCanvas.tsx` | ç­–ç•¥éƒ¨ç½² UI | âœ… å®Œæˆ (éœ€æ‰©å±•) |
| RiskSettings | `components/canvas/RiskSettings.tsx` | é£é™©é…ç½® | âœ… å®Œæˆ (éœ€æ‰©å±•) |
| AgentStore | `store/agent.ts` | Agent çŠ¶æ€ç®¡ç† | âœ… å®Œæˆ (éœ€æ‰©å±•) |
| NotificationStore | `store/notification.ts` | é€šçŸ¥ç³»ç»Ÿ | âœ… å®Œæˆ |
| ExchangeStore | `store/exchange.ts` | äº¤æ˜“æ‰€è¿æ¥ | âœ… å®Œæˆ |

### æ–°å¢ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| KillSwitch | `components/safety/KillSwitch.tsx` | ç´§æ€¥åœæ­¢æŒ‰é’® | ğŸ†• å¾…åˆ›å»º |
| KillSwitchModal | `components/safety/KillSwitchModal.tsx` | ç´§æ€¥åœæ­¢ç¡®è®¤å¼¹çª— | ğŸ†• å¾…åˆ›å»º |
| ApprovalFlow | `components/deployment/ApprovalFlow.tsx` | å®¡æ‰¹æµç¨‹ç»„ä»¶ | ğŸ†• å¾…åˆ›å»º |
| MarginAlert | `components/safety/MarginAlert.tsx` | ä¿è¯é‡‘é¢„è­¦ | ğŸ†• å¾…åˆ›å»º |
| CircuitBreaker | `components/safety/CircuitBreaker.tsx` | ç†”æ–­çŠ¶æ€æ˜¾ç¤º | ğŸ†• å¾…åˆ›å»º |
| useSafety | `hooks/useSafety.ts` | å®‰å…¨åŠŸèƒ½ Hook | ğŸ†• å¾…åˆ›å»º |
| SafetyStore | `store/safety.ts` | å®‰å…¨çŠ¶æ€ç®¡ç† | ğŸ†• å¾…åˆ›å»º |

---

## åŠŸèƒ½è®¾è®¡

### V3 è®¾è®¡è§„èŒƒæ‘˜è¦

#### S30: Kill Switch ç´§æ€¥åœæ­¢

| åŠŸèƒ½ | æè¿° | éªŒæ”¶æ ‡å‡† |
|------|------|----------|
| ä¸€é”®åœæ­¢ | ç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“æ´»åŠ¨ | ç‚¹å‡»å < 1ç§’åœæ­¢æ‰€æœ‰è®¢å• |
| åŒé‡ç¡®è®¤ | é˜²æ­¢è¯¯è§¦ | éœ€è¦äºŒæ¬¡ç¡®è®¤æˆ–é•¿æŒ‰ |
| å…¨å±€å¯è§ | ä»»ä½•é¡µé¢éƒ½èƒ½è®¿é—® | Header å›ºå®šä½ç½®æ˜¾ç¤º |
| çŠ¶æ€åé¦ˆ | æ¸…æ™°çš„æ‰§è¡Œåé¦ˆ | æ˜¾ç¤ºåœæ­¢çš„ç­–ç•¥æ•°å’Œè®¢å•æ•° |

#### S31: å®¡æ‰¹æµç¨‹

| åŠŸèƒ½ | æè¿° | éªŒæ”¶æ ‡å‡† |
|------|------|----------|
| å¤šæ­¥ç¡®è®¤ | Live éƒ¨ç½²åˆ†æ­¥éª¤ç¡®è®¤ | è‡³å°‘ 3 æ­¥ç¡®è®¤ |
| é£é™©æŠ«éœ² | æ˜¾ç¤ºæ½œåœ¨é£é™© | å¼ºåˆ¶é˜…è¯»é£é™©æç¤º |
| å†·å´æœŸ | é˜²æ­¢å†²åŠ¨å†³ç­– | å¯é€‰ 5 åˆ†é’Ÿå†·å´æœŸ |
| å®¡è®¡æ—¥å¿— | è®°å½•æ‰€æœ‰å®¡æ‰¹ | ä¿å­˜å®¡æ‰¹å†å² |

#### S28: ä¿è¯é‡‘/å¼ºå¹³é¢„è­¦

| åŠŸèƒ½ | æè¿° | éªŒæ”¶æ ‡å‡† |
|------|------|----------|
| å®æ—¶ç›‘æ§ | ç›‘æ§ä¿è¯é‡‘ç‡ | æ¯ 10 ç§’æ›´æ–° |
| åˆ†çº§é¢„è­¦ | ä¸åŒçº§åˆ«è­¦å‘Š | é»„è‰² (50%) / æ©™è‰² (30%) / çº¢è‰² (15%) |
| è‡ªåŠ¨é€šçŸ¥ | æ¨é€é¢„è­¦æ¶ˆæ¯ | Toast + å£°éŸ³æé†’ |
| è‡ªåŠ¨å‡ä»“ | å¯é€‰è‡ªåŠ¨å‡ä»“ | ç”¨æˆ·å¯é…ç½® |

---

## ç±»å‹è®¾è®¡

```typescript
// types/safety.ts

/** Kill Switch çŠ¶æ€ */
export type KillSwitchStatus = 'ready' | 'triggered' | 'cooldown'

/** Kill Switch æ‰§è¡Œç»“æœ */
export interface KillSwitchResult {
  success: boolean
  stoppedStrategies: number
  cancelledOrders: number
  timestamp: number
  executionTime: number // ms
}

/** å®¡æ‰¹æ­¥éª¤ */
export type ApprovalStep =
  | 'risk_review'      // é£é™©å®¡æŸ¥
  | 'capital_confirm'  // èµ„é‡‘ç¡®è®¤
  | 'final_confirm'    // æœ€ç»ˆç¡®è®¤

/** å®¡æ‰¹çŠ¶æ€ */
export interface ApprovalState {
  currentStep: ApprovalStep
  completedSteps: ApprovalStep[]
  riskAcknowledged: boolean
  cooldownRemaining?: number // ç§’
  approvalToken?: string
}

/** ä¿è¯é‡‘é¢„è­¦çº§åˆ« */
export type MarginAlertLevel = 'safe' | 'warning' | 'danger' | 'critical'

/** ä¿è¯é‡‘çŠ¶æ€ */
export interface MarginStatus {
  marginRatio: number         // ä¿è¯é‡‘ç‡ (0-100)
  usedMargin: number         // å·²ç”¨ä¿è¯é‡‘
  availableMargin: number    // å¯ç”¨ä¿è¯é‡‘
  alertLevel: MarginAlertLevel
  estimatedLiquidationPrice?: number
}

/** ç†”æ–­é…ç½® */
export interface CircuitBreakerConfig {
  enabled: boolean
  dailyLossLimit: number     // æ—¥äºæŸé™é¢ (%)
  hourlyLossLimit: number    // å°æ—¶äºæŸé™é¢ (%)
  consecutiveLossLimit: number // è¿ç»­äºæŸæ¬¡æ•°
  autoResume: boolean        // è‡ªåŠ¨æ¢å¤
  resumeAfterMinutes: number // æ¢å¤ç­‰å¾…æ—¶é—´
}

/** ç†”æ–­çŠ¶æ€ */
export interface CircuitBreakerStatus {
  triggered: boolean
  triggerReason?: string
  triggeredAt?: number
  resumeAt?: number
  currentDailyLoss: number
  currentHourlyLoss: number
  consecutiveLosses: number
}

/** å®‰å…¨çŠ¶æ€æ±‡æ€» */
export interface SafetyStatus {
  killSwitch: KillSwitchStatus
  marginStatus: MarginStatus
  circuitBreaker: CircuitBreakerStatus
  lastUpdated: number
}
```

---

## UI è®¾è®¡

### Kill Switch ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Logo] Delta Terminal    ğŸ”´ STOP â”‚ â”‚  â† Kill Switch æŒ‰é’®
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡»åå¼¹å‡º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        âš ï¸ ç´§æ€¥åœæ­¢ç¡®è®¤                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  å³å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:                     â”‚
â”‚  â€¢ åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„ç­–ç•¥ (3ä¸ª)          â”‚
â”‚  â€¢ å–æ¶ˆæ‰€æœ‰æŒ‚å• (5ä¸ª)                  â”‚
â”‚  â€¢ å¹³ä»“æ‰€æœ‰æŒä»“ â˜ (å¯é€‰)               â”‚
â”‚                                      â”‚
â”‚  âš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€                    â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     [ é•¿æŒ‰ 3 ç§’ç¡®è®¤åœæ­¢ ]          â”‚â”‚
â”‚  â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â”‚            [ å–æ¶ˆ ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®¡æ‰¹æµç¨‹ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Live éƒ¨ç½²å®¡æ‰¹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  æ­¥éª¤ 1/3: é£é™©å®¡æŸ¥                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ é£é™©æç¤º                       â”‚â”‚
â”‚  â”‚                                  â”‚â”‚
â”‚  â”‚ â€¢ æ­¤ç­–ç•¥å°†ä½¿ç”¨çœŸå®èµ„é‡‘äº¤æ˜“          â”‚â”‚
â”‚  â”‚ â€¢ æœ€å¤§å¯èƒ½æŸå¤±: $500 (5%)          â”‚â”‚
â”‚  â”‚ â€¢ å†å²å›æµ‹æ”¶ç›Šä¸ä»£è¡¨æœªæ¥è¡¨ç°        â”‚â”‚
â”‚  â”‚ â€¢ å¸‚åœºæ³¢åŠ¨å¯èƒ½å¯¼è‡´è¶…å‡ºé¢„æœŸæŸå¤±      â”‚â”‚
â”‚  â”‚                                  â”‚â”‚
â”‚  â”‚ â˜‘ æˆ‘å·²é˜…è¯»å¹¶ç†è§£ä»¥ä¸Šé£é™©           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â”‚  â—‹ é£é™©å®¡æŸ¥ â”€â”€â”€ â—‹ èµ„é‡‘ç¡®è®¤ â”€â”€â”€ â—‹ æœ€ç»ˆç¡®è®¤â”‚
â”‚                                      â”‚
â”‚     [ è¿”å› ]           [ ä¸‹ä¸€æ­¥ ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿è¯é‡‘é¢„è­¦ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿è¯é‡‘çŠ¶æ€                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ä¿è¯é‡‘ç‡: 35% âš ï¸                     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚  â””â”€ å±é™© â”€â”´â”€ è­¦å‘Š â”€â”´â”€ å®‰å…¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â”‚  å·²ç”¨ä¿è¯é‡‘:  $6,500                  â”‚
â”‚  å¯ç”¨ä¿è¯é‡‘:  $3,500                  â”‚
â”‚  é¢„ä¼°å¼ºå¹³ä»·:  $38,200                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ ä¿è¯é‡‘ç‡ä½äº 50%               â”‚â”‚
â”‚  â”‚ å»ºè®®å‡å°‘æŒä»“æˆ–è¿½åŠ ä¿è¯é‡‘           â”‚â”‚
â”‚  â”‚              [ ç«‹å³å‡ä»“ ]         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stories

### Story 8.1: Kill Switch ç´§æ€¥åœæ­¢

**æ ‡é¢˜**: å®ç° Kill Switch ç´§æ€¥åœæ­¢åŠŸèƒ½

**æè¿°**:
åˆ›å»ºä¸€é”®ç´§æ€¥åœæ­¢åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™ç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“æ´»åŠ¨ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ›å»º `types/safety.ts` ç±»å‹å®šä¹‰
- [ ] åˆ›å»º `store/safety.ts` å®‰å…¨çŠ¶æ€ç®¡ç†
- [ ] åˆ›å»º `components/safety/KillSwitch.tsx` æŒ‰é’®ç»„ä»¶
- [ ] åˆ›å»º `components/safety/KillSwitchModal.tsx` ç¡®è®¤å¼¹çª—
- [ ] Kill Switch æŒ‰é’®åœ¨ Header ä¸­å…¨å±€å¯è§
- [ ] æ”¯æŒé•¿æŒ‰ 3 ç§’ç¡®è®¤æœºåˆ¶
- [ ] æ‰§è¡Œåæ˜¾ç¤ºåœæ­¢çš„ç­–ç•¥æ•°å’Œè®¢å•æ•°
- [ ] æ”¯æŒå¯é€‰çš„å¹³ä»“æ‰€æœ‰æŒä»“
- [ ] è§¦å‘åå‘é€ç³»ç»Ÿé€šçŸ¥
- [ ] è®°å½• Kill Switch æ‰§è¡Œæ—¥å¿—

**æŠ€æœ¯è®¾è®¡**:
```typescript
interface KillSwitchProps {
  className?: string
}

interface KillSwitchModalProps {
  isOpen: boolean
  onClose: () => void
  onConfirm: (closePositions: boolean) => Promise<KillSwitchResult>
  activeStrategies: number
  pendingOrders: number
}
```

---

### Story 8.2: Live éƒ¨ç½²å®¡æ‰¹æµç¨‹

**æ ‡é¢˜**: å®ç° Live éƒ¨ç½²å¤šæ­¥å®¡æ‰¹æµç¨‹

**æè¿°**:
åˆ›å»º Live éƒ¨ç½²çš„å¤šæ­¥ç¡®è®¤æµç¨‹ï¼Œç¡®ä¿ç”¨æˆ·å……åˆ†ç†è§£é£é™©åå†è¿›è¡ŒçœŸå®èµ„é‡‘äº¤æ˜“ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ›å»º `components/deployment/ApprovalFlow.tsx` å®¡æ‰¹æµç¨‹ç»„ä»¶
- [ ] å®ç° 3 æ­¥å®¡æ‰¹: é£é™©å®¡æŸ¥ â†’ èµ„é‡‘ç¡®è®¤ â†’ æœ€ç»ˆç¡®è®¤
- [ ] é£é™©å®¡æŸ¥æ­¥éª¤å¼ºåˆ¶é˜…è¯»é£é™©æç¤º
- [ ] èµ„é‡‘ç¡®è®¤æ­¥éª¤æ˜¾ç¤ºå°†ä½¿ç”¨çš„èµ„é‡‘è¯¦æƒ…
- [ ] æœ€ç»ˆç¡®è®¤æ­¥éª¤æ˜¾ç¤ºå®Œæ•´é…ç½®æ‘˜è¦
- [ ] æ”¯æŒå¯é€‰çš„ 5 åˆ†é’Ÿå†·å´æœŸ
- [ ] ç”Ÿæˆå®¡æ‰¹ Token ç”¨äºéƒ¨ç½²éªŒè¯
- [ ] è®°å½•å®¡æ‰¹å†å²åˆ°æ—¥å¿—
- [ ] é›†æˆåˆ° DeployCanvas çš„ Live æ¨¡å¼

**å®¡æ‰¹æµç¨‹çŠ¶æ€æœº**:
```
risk_review â†’ capital_confirm â†’ final_confirm â†’ approved
     â†‘              â†‘               â†‘
     â””â”€â”€ è¿”å› â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Story 8.3: ä¿è¯é‡‘é¢„è­¦ç³»ç»Ÿ

**æ ‡é¢˜**: å®ç°ä¿è¯é‡‘å®æ—¶ç›‘æ§å’Œé¢„è­¦

**æè¿°**:
åˆ›å»ºä¿è¯é‡‘ç‡å®æ—¶ç›‘æ§åŠŸèƒ½ï¼Œåœ¨æ¥è¿‘å¼ºå¹³çº¿æ—¶å‘å‡ºé¢„è­¦ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ›å»º `components/safety/MarginAlert.tsx` é¢„è­¦ç»„ä»¶
- [ ] åˆ›å»º `hooks/useMarginMonitor.ts` ç›‘æ§ Hook
- [ ] å®æ—¶è®¡ç®—ä¿è¯é‡‘ç‡ (æ¯ 10 ç§’æ›´æ–°)
- [ ] åˆ†çº§é¢„è­¦: safe (>50%) / warning (30-50%) / danger (15-30%) / critical (<15%)
- [ ] é¢„è­¦çº§åˆ«å˜åŒ–æ—¶å‘é€ Toast é€šçŸ¥
- [ ] critical çº§åˆ«è§¦å‘å£°éŸ³æé†’
- [ ] æ˜¾ç¤ºé¢„ä¼°å¼ºå¹³ä»·æ ¼
- [ ] æä¾›å¿«æ·å‡ä»“å…¥å£
- [ ] é›†æˆåˆ° MonitorCanvas ä¾§è¾¹æ 

**é¢„è­¦é˜ˆå€¼**:
```typescript
const MARGIN_THRESHOLDS = {
  safe: 50,      // > 50% å®‰å…¨
  warning: 30,   // 30-50% è­¦å‘Š
  danger: 15,    // 15-30% å±é™©
  critical: 0,   // < 15% ä¸´ç•Œ
}
```

---

### Story 8.4: ç†”æ–­æœºåˆ¶

**æ ‡é¢˜**: å®ç°äº¤æ˜“ç†”æ–­æœºåˆ¶

**æè¿°**:
åˆ›å»ºè‡ªåŠ¨ç†”æ–­æœºåˆ¶ï¼Œåœ¨å¼‚å¸¸äºæŸæƒ…å†µä¸‹è‡ªåŠ¨åœæ­¢äº¤æ˜“ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ›å»º `components/safety/CircuitBreaker.tsx` ç†”æ–­çŠ¶æ€ç»„ä»¶
- [ ] åˆ›å»ºç†”æ–­é…ç½® UI (å¯åœ¨è®¾ç½®ä¸­é…ç½®)
- [ ] å®ç°æ—¥äºæŸé™é¢ç†”æ–­ (é»˜è®¤ 10%)
- [ ] å®ç°å°æ—¶äºæŸé™é¢ç†”æ–­ (é»˜è®¤ 5%)
- [ ] å®ç°è¿ç»­äºæŸæ¬¡æ•°ç†”æ–­ (é»˜è®¤ 5 æ¬¡)
- [ ] ç†”æ–­è§¦å‘æ—¶è‡ªåŠ¨åœæ­¢æ‰€æœ‰ç­–ç•¥
- [ ] ç†”æ–­è§¦å‘æ—¶å‘é€é€šçŸ¥
- [ ] æ”¯æŒæ‰‹åŠ¨è§£é™¤ç†”æ–­
- [ ] æ”¯æŒå¯é€‰çš„è‡ªåŠ¨æ¢å¤
- [ ] ç†”æ–­çŠ¶æ€åœ¨ Header ä¸­æ˜¾ç¤º

**ç†”æ–­è§„åˆ™**:
```typescript
const DEFAULT_CIRCUIT_BREAKER: CircuitBreakerConfig = {
  enabled: true,
  dailyLossLimit: 10,        // æ—¥äºæŸ 10% è§¦å‘
  hourlyLossLimit: 5,        // æ—¶äºæŸ 5% è§¦å‘
  consecutiveLossLimit: 5,   // è¿ç»­ 5 æ¬¡äºæŸè§¦å‘
  autoResume: false,         // ä¸è‡ªåŠ¨æ¢å¤
  resumeAfterMinutes: 60,    // æ‰‹åŠ¨è§£é™¤å 60 åˆ†é’Ÿå†·å´
}
```

---

## é›†æˆè®¡åˆ’

### Header é›†æˆ

```tsx
// components/layout/Header.tsx
export function Header() {
  return (
    <header>
      {/* ... existing content ... */}

      {/* å®‰å…¨çŠ¶æ€åŒºåŸŸ */}
      <div className="flex items-center gap-2">
        <CircuitBreakerIndicator />  {/* ç†”æ–­çŠ¶æ€æŒ‡ç¤º */}
        <MarginIndicator />          {/* ä¿è¯é‡‘çŠ¶æ€æŒ‡ç¤º */}
        <KillSwitch />               {/* ç´§æ€¥åœæ­¢æŒ‰é’® */}
      </div>
    </header>
  )
}
```

### DeployCanvas é›†æˆ

```tsx
// DeployCanvas Live æ¨¡å¼æµç¨‹
function handleLiveDeploy() {
  // 1. æ‰“å¼€å®¡æ‰¹æµç¨‹
  setShowApprovalFlow(true)
}

function handleApprovalComplete(token: string) {
  // 2. éªŒè¯å®¡æ‰¹ Token
  // 3. æ‰§è¡Œéƒ¨ç½²
  deploy({ ...config, approvalToken: token })
}
```

---

## é»˜è®¤å€¼

```typescript
// å®‰å…¨é…ç½®é»˜è®¤å€¼
const DEFAULT_SAFETY_CONFIG = {
  killSwitch: {
    confirmMethod: 'longPress',  // 'longPress' | 'doubleClick'
    longPressDuration: 3000,     // 3 ç§’
    closePositionsDefault: false,
  },
  approval: {
    coolingPeriodEnabled: false,
    coolingPeriodMinutes: 5,
    requireRiskAcknowledge: true,
  },
  marginAlert: {
    enabled: true,
    soundEnabled: true,
    autoReducePosition: false,
  },
  circuitBreaker: {
    enabled: true,
    dailyLossLimit: 10,
    hourlyLossLimit: 5,
    consecutiveLossLimit: 5,
    autoResume: false,
  },
}
```

---

## å®‰å…¨è€ƒè™‘

### Kill Switch å®‰å…¨æ€§

- **é˜²è¯¯è§¦**: é•¿æŒ‰ 3 ç§’ç¡®è®¤ï¼Œé˜²æ­¢æ„å¤–è§¦å‘
- **åŸå­æ“ä½œ**: æ‰€æœ‰åœæ­¢æ“ä½œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆ
- **å¤±è´¥å›æ»š**: å¦‚æœéƒ¨åˆ†åœæ­¢å¤±è´¥ï¼Œæ¢å¤å·²åœæ­¢çš„ç­–ç•¥
- **ç¦»çº¿å¯ç”¨**: æœ¬åœ°ä¹Ÿèƒ½è§¦å‘ (é€šè¿‡ API å–æ¶ˆè®¢å•)

### å®¡æ‰¹æµç¨‹å®‰å…¨æ€§

- **Token éªŒè¯**: å®¡æ‰¹ Token æœ‰æ—¶æ•ˆæ€§ (5 åˆ†é’Ÿ)
- **ä¸å¯è·³è¿‡**: Live æ¨¡å¼å¼ºåˆ¶è¦æ±‚å®Œæˆæ‰€æœ‰æ­¥éª¤
- **å®¡è®¡è¿½è¸ª**: æ‰€æœ‰å®¡æ‰¹æ“ä½œè®°å½•æ—¥å¿—

### ä¿è¯é‡‘é¢„è­¦å®‰å…¨æ€§

- **å®æ—¶æ›´æ–°**: ä¸ä¾èµ–ç¼“å­˜ï¼Œå®æ—¶æŸ¥è¯¢äº¤æ˜“æ‰€
- **å¤šé€šé“é€šçŸ¥**: Toast + å£°éŸ³ + å¯é€‰é‚®ä»¶
- **è‡ªåŠ¨ä¿æŠ¤**: å¯é…ç½®è‡ªåŠ¨å‡ä»“

---

## Definition of Done

- [ ] æ‰€æœ‰ 4 ä¸ª Stories å®Œæˆå¹¶é€šè¿‡éªŒæ”¶
- [ ] Kill Switch åŠŸèƒ½æ­£å¸¸ï¼Œ< 1 ç§’å“åº”
- [ ] å®¡æ‰¹æµç¨‹é›†æˆåˆ° DeployCanvas
- [ ] ä¿è¯é‡‘é¢„è­¦å®æ—¶æ›´æ–°
- [ ] ç†”æ–­æœºåˆ¶å¯é…ç½®å¹¶æ­£å¸¸è§¦å‘
- [ ] Header é›†æˆå®‰å…¨çŠ¶æ€æ˜¾ç¤º
- [ ] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] æ—  P0/P1 çº§åˆ« Bug
- [ ] å®‰å…¨åŠŸèƒ½æœ‰å•å…ƒæµ‹è¯•è¦†ç›–

---

## éªŒè¯æ¸…å•

### èŒƒå›´éªŒè¯
- [x] Epic å¯åœ¨ 4 ä¸ª Stories å†…å®Œæˆ
- [x] æ— éœ€æ¶æ„å±‚é¢å˜æ›´
- [x] éµå¾ªç°æœ‰ç»„ä»¶æ¨¡å¼
- [x] å¤ç”¨å·²æœ‰ UI ç»„ä»¶

### é£é™©è¯„ä¼°
- [x] å¯¹ç°æœ‰ç³»ç»Ÿé£é™©: ä½ (æ–°å¢ç»„ä»¶)
- [x] å®‰å…¨åŠŸèƒ½å¿…é¡»åœ¨ Live å‰å®Œæˆ
- [x] å›æ»šæ–¹æ¡ˆå¯è¡Œ (å®‰å…¨åŠŸèƒ½å¯å•ç‹¬ç¦ç”¨)

---

**åˆ›å»ºæ—¶é—´**: 2025-12-26
**åˆ›å»ºè€…**: YOLO Workflow Autonomous Agent
**æ¥æº**: V3 è®¾è®¡æ–‡æ¡£ S28/S30/S31
