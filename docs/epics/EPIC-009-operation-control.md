# Epic 009: æ“ä½œæ§åˆ¶å¢å¼º - Brownfield Enhancement

> ä¸º Delta Terminal æ·»åŠ æ‰‹åŠ¨å¹²é¢„é¢æ¿å’Œç‰ˆæœ¬å›æ»šåŠŸèƒ½

---

## Epic å…ƒæ•°æ®

| å±æ€§ | å€¼ |
|------|-----|
| Epic ID | EPIC-009 |
| åç§° | æ“ä½œæ§åˆ¶å¢å¼º (Operation Control) |
| ç±»å‹ | Brownfield Enhancement |
| ä¼˜å…ˆçº§ | P1 (é«˜) |
| é¢„ä¼° Stories | 3 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-26 |
| PRD å‚è€ƒ | Feature S24, S25 |
| å‰ç½®ä¾èµ– | EPIC-001 âœ…, EPIC-003 âœ… |

---

## Epic Goal

**èµ‹äºˆç”¨æˆ·å¯¹è¿è¡Œç­–ç•¥çš„ç²¾ç»†æ§åˆ¶èƒ½åŠ›,æ”¯æŒå®æ—¶å‚æ•°è°ƒæ•´ã€ç´§æ€¥æ“ä½œå’Œç­–ç•¥ç‰ˆæœ¬ç®¡ç†ã€‚**

æ ¸å¿ƒåŠŸèƒ½:
1. **æ‰‹åŠ¨å¹²é¢„é¢æ¿** (S24) - å®æ—¶è°ƒæ•´å‚æ•°ã€æ‰§è¡Œç´§æ€¥æ“ä½œã€è®°å½•å¹²é¢„å†å²
2. **ç‰ˆæœ¬å›æ»š** (S25) - æŸ¥çœ‹ç­–ç•¥ç‰ˆæœ¬å†å²ã€ä¸€é”®å›æ»šã€ç‰ˆæœ¬å¯¹æ¯”

---

## ç°æœ‰ç³»ç»Ÿä¸Šä¸‹æ–‡

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Next.js 15 + React 19 + TypeScript
- **çŠ¶æ€ç®¡ç†**: Zustand
- **UI ç»„ä»¶**: Shadcn/ui + TailwindCSS + RiverBit Design System
- **A2UI æ§ä»¶**: ParamControl, ParamSlider, ParamToggle, ParamButtonGroup

### ç›¸å…³ç°æœ‰ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| CanvasPanel | `components/canvas/CanvasPanel.tsx` | ç­–ç•¥ææ¡ˆæ»‘å‡ºé¢æ¿ (åŒ…å«å‚æ•°ç¼–è¾‘é€»è¾‘) |
| MonitorCanvas | `components/canvas/MonitorCanvas.tsx` | ç­–ç•¥ç›‘æ§é¢æ¿ (åŒ…å«æš‚åœ/åœæ­¢æ“ä½œ) |
| DeployCanvas | `components/canvas/DeployCanvas.tsx` | éƒ¨ç½²ç¡®è®¤é¢æ¿ |
| ParamControl | `components/a2ui/controls/ParamControl.tsx` | ç»Ÿä¸€å‚æ•°æ§åˆ¶ç»„ä»¶ |
| useParamConstraints | `hooks/useParamConstraints.ts` | å‚æ•°çº¦æŸéªŒè¯ Hook |
| AgentStore | `store/agent.ts` | Agent çŠ¶æ€ç®¡ç† |
| StrategyStore | `store/strategy.ts` | ç­–ç•¥æ•°æ®ç®¡ç† (éœ€åˆ›å»º) |

### ç°æœ‰å‚æ•°ç¼–è¾‘æœºåˆ¶

CanvasPanel å·²å®ç°:
- âœ… æ ¸å¿ƒå‚æ•° (L1) å’Œé«˜çº§å‚æ•° (L2) åˆ†ç¦»å±•ç¤º
- âœ… `ParamControl` ç»Ÿä¸€æ§åˆ¶ç»„ä»¶ (æ”¯æŒ slider, toggle, select, text ç­‰)
- âœ… å®æ—¶å‚æ•°éªŒè¯ (`useParamConstraints`)
- âœ… å‚æ•°é‡ç½®åŠŸèƒ½
- âœ… ä¿®æ”¹åæäº¤æµç¨‹

MonitorCanvas å·²å®ç°:
- âœ… æš‚åœ/æ¢å¤/åœæ­¢ç­–ç•¥æ“ä½œ
- âœ… å®æ—¶çŠ¶æ€å±•ç¤º
- âœ… æŒä»“å’Œäº¤æ˜“è®°å½•

### é›†æˆç‚¹

1. **MonitorCanvas æ‰©å±•** - æ·»åŠ "å‚æ•°è°ƒæ•´"æ ‡ç­¾é¡µ
2. **StrategyStore æ–°å¢** - ç‰ˆæœ¬å†å²ç®¡ç†
3. **API å±‚** - `lib/api.ts` æ–°å¢å¹²é¢„å’Œç‰ˆæœ¬ç›¸å…³æ¥å£
4. **InterventionStore** - å¹²é¢„è®°å½•ç®¡ç†

---

## å¢å¼ºè¯¦æƒ…

### PRD è§„èŒƒæ‘˜è¦

#### S24. æ‰‹åŠ¨å¹²é¢„é¢æ¿

**åœºæ™¯**: ç”¨æˆ·å‘ç°ç­–ç•¥åœ¨ç‰¹å®šå¸‚åœºæ¡ä»¶ä¸‹éœ€è¦ä¸´æ—¶è°ƒæ•´å‚æ•°æˆ–æ‰§è¡Œç´§æ€¥æ“ä½œ

**åŠŸèƒ½éœ€æ±‚**:
1. **å®æ—¶å‚æ•°è°ƒæ•´**
   - æ˜¾ç¤ºå½“å‰ç­–ç•¥çš„æ‰€æœ‰å¯è°ƒå‚æ•° (å¤ç”¨ `ParamControl` æœºåˆ¶)
   - æ”¯æŒå®æ—¶ä¿®æ”¹å¹¶ç”Ÿæ•ˆ (ä¸å½±å“å†å²ç‰ˆæœ¬)
   - æ˜¾ç¤ºè°ƒæ•´å‰åå‚æ•°å¯¹æ¯”
   - å‚æ•°éªŒè¯ (å¤ç”¨ `useParamConstraints`)

2. **ç´§æ€¥æ“ä½œæŒ‰é’®**
   - ğŸ›‘ å¹³ä»“æ‰€æœ‰æŒä»“ (Emergency Stop)
   - â¸ï¸ æš‚åœäº¤æ˜“ (å·²åœ¨ MonitorCanvas å®ç°)
   - ğŸ”„ é‡å¯ç­–ç•¥ (æ¸…é™¤çŠ¶æ€é‡æ–°å¼€å§‹)
   - ğŸš« ç¦ç”¨æ–°å¼€ä»“ (ä»…å…è®¸å¹³ä»“)

3. **å¹²é¢„å†å²è®°å½•**
   - è®°å½•æ‰€æœ‰äººå·¥å¹²é¢„æ“ä½œ (å‚æ•°ä¿®æ”¹ã€ç´§æ€¥æ“ä½œ)
   - æ—¶é—´æˆ³ã€æ“ä½œç±»å‹ã€æ“ä½œå‰åçŠ¶æ€
   - æ”¯æŒå¯¼å‡ºå¹²é¢„æ—¥å¿—

**UI è®¾è®¡** (æ‰©å±• MonitorCanvas):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥ç›‘æ§ - è¶‹åŠ¿è¿½è¸ªç­–ç•¥                            â”‚
â”‚ [æ¦‚è§ˆ] [æŒä»“] [äº¤æ˜“] [å‚æ•°è°ƒæ•´] [å¹²é¢„å†å²]          â”‚ â† æ–°å¢æ ‡ç­¾é¡µ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ã€Œå‚æ•°è°ƒæ•´ã€æ ‡ç­¾é¡µ                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ å®æ—¶å‚æ•°è°ƒæ•´ä¼šç«‹å³å½±å“ç­–ç•¥è¡Œä¸º                â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ æ ¸å¿ƒå‚æ•°                                     â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚ â”‚
â”‚ â”‚ æ­¢æŸç™¾åˆ†æ¯”    [====â—===] 5%  (åŸå€¼: 3%)      â”‚ â”‚
â”‚ â”‚ æ­¢ç›ˆç™¾åˆ†æ¯”    [========â—] 15% (åŸå€¼: 10%)    â”‚ â”‚
â”‚ â”‚ æŒä»“æ•°é‡      [==â—======] 0.5 BTC (åŸå€¼: 1)  â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ é«˜çº§å‚æ•° (2) â–¼                               â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚ â”‚
â”‚ â”‚ é‡æ–°è¯„ä¼°å‘¨æœŸ  [â—========] 5min (åŸå€¼: 15min) â”‚ â”‚
â”‚ â”‚ ä¿¡å·å¼ºåº¦é˜ˆå€¼  [=====â—===] 0.7  (åŸå€¼: 0.5)  â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ å‚æ•°éªŒè¯                                     â”‚ â”‚
â”‚ â”‚ âœ“ æ‰€æœ‰å‚æ•°åœ¨æœ‰æ•ˆèŒƒå›´å†…                        â”‚ â”‚
â”‚ â”‚ âš ï¸ æ­¢æŸè®¾ç½®è¾ƒä¸ºæ¿€è¿›,å»ºè®®è°¨æ…è°ƒæ•´              â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚         [é‡ç½®] [é¢„è§ˆå½±å“] [åº”ç”¨å‚æ•°ä¿®æ”¹]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ç´§æ€¥æ“ä½œ                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ›‘ å¹³ä»“æ‰€æœ‰æŒä»“    ğŸš« ç¦ç”¨æ–°å¼€ä»“              â”‚ â”‚
â”‚ â”‚ ğŸ”„ é‡å¯ç­–ç•¥        â¸ï¸ æš‚åœç­–ç•¥               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€Œå¹²é¢„å†å²ã€æ ‡ç­¾é¡µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¹²é¢„è®°å½• (æœ€è¿‘ 20 æ¡)                   [å¯¼å‡ºCSV] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2025-12-26 14:23:45 | å‚æ•°è°ƒæ•´                   â”‚
â”‚ â”” æ­¢æŸç™¾åˆ†æ¯”: 3% â†’ 5% (åŸå› : å¸‚åœºæ³¢åŠ¨åŠ å‰§)       â”‚
â”‚                                                 â”‚
â”‚ 2025-12-26 13:10:12 | ç´§æ€¥æ“ä½œ                   â”‚
â”‚ â”” æ‰§è¡Œ: å¹³ä»“æ‰€æœ‰æŒä»“ (åŸå› : äº¤æ˜“æ‰€å¼‚å¸¸)          â”‚
â”‚                                                 â”‚
â”‚ 2025-12-26 11:05:33 | å‚æ•°è°ƒæ•´                   â”‚
â”‚ â”” æŒä»“æ•°é‡: 1.0 â†’ 0.5 BTC (åŸå› : é™ä½é£é™©æ•å£)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S25. ç‰ˆæœ¬å›æ»š

**åœºæ™¯**: ç”¨æˆ·å‘ç°æœ€æ–°ç­–ç•¥ä¿®æ”¹åè¡¨ç°ä¸ä½³,å¸Œæœ›å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬

**åŠŸèƒ½éœ€æ±‚**:
1. **ç­–ç•¥ç‰ˆæœ¬å†å²**
   - è®°å½•æ¯æ¬¡å‚æ•°ä¿®æ”¹ä¸ºä¸€ä¸ªç‰ˆæœ¬ (å¿«ç…§æœºåˆ¶)
   - æ˜¾ç¤ºç‰ˆæœ¬åˆ—è¡¨: æ—¶é—´ã€ç‰ˆæœ¬å·ã€ä¿®æ”¹æ‘˜è¦ã€åˆ›å»ºåŸå› 
   - æ ‡è®°å½“å‰æ¿€æ´»ç‰ˆæœ¬
   - ç‰ˆæœ¬æ ‡ç­¾: `v1.0`, `v1.1`, `v2.0` (é‡å¤§ä¿®æ”¹å‡çº§ä¸»ç‰ˆæœ¬)

2. **ä¸€é”®å›æ»š**
   - é€‰æ‹©å†å²ç‰ˆæœ¬åç‚¹å‡»"å›æ»š"
   - æ˜¾ç¤ºå›æ»šå‰åå‚æ•°å¯¹æ¯”
   - äºŒæ¬¡ç¡®è®¤ (é¿å…è¯¯æ“ä½œ)
   - å›æ»šæ“ä½œæœ¬èº«è®°å½•ä¸ºæ–°ç‰ˆæœ¬ (ä¾¿äºè¿½æº¯)

3. **ç‰ˆæœ¬å¯¹æ¯” Diff**
   - å¹¶æ’å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬çš„å‚æ•°å·®å¼‚
   - é«˜äº®æ˜¾ç¤ºå˜æ›´çš„å‚æ•°
   - æ˜¾ç¤ºå˜æ›´åŸå›  (å¦‚æœæœ‰è®°å½•)

**UI è®¾è®¡** (æ–°å¢ VersionHistoryCanvas):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥ç‰ˆæœ¬å†å² - è¶‹åŠ¿è¿½è¸ªç­–ç•¥                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰ˆæœ¬åˆ—è¡¨                            [åˆ›å»ºç‰ˆæœ¬å¿«ç…§] â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â— v2.1 (å½“å‰) - 2025-12-26 14:23            â”‚ â”‚
â”‚ â”‚   å‚æ•°è°ƒæ•´: æ­¢æŸä» 3% è°ƒè‡³ 5%                  â”‚ â”‚
â”‚ â”‚   åŸå› : å¸‚åœºæ³¢åŠ¨åŠ å‰§                           â”‚ â”‚
â”‚ â”‚   [å¯¹æ¯”] [è¯¦æƒ…]                               â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ v2.0 - 2025-12-25 18:30                   â”‚ â”‚
â”‚ â”‚   å¤§ç‰ˆæœ¬å‡çº§: æ–°å¢åŠ¨æ€æ­¢ç›ˆé€»è¾‘                  â”‚ â”‚
â”‚ â”‚   [å›æ»š] [å¯¹æ¯”] [è¯¦æƒ…]                        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ v1.2 - 2025-12-24 10:15                   â”‚ â”‚
â”‚ â”‚   å‚æ•°è°ƒæ•´: æŒä»“æ•°é‡ä» 1.0 é™è‡³ 0.5 BTC        â”‚ â”‚
â”‚ â”‚   [å›æ»š] [å¯¹æ¯”] [è¯¦æƒ…]                        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ v1.1 - 2025-12-23 16:40                   â”‚ â”‚
â”‚ â”‚   å‚æ•°è°ƒæ•´: ä¿¡å·é˜ˆå€¼ä¼˜åŒ–                       â”‚ â”‚
â”‚ â”‚   [å›æ»š] [å¯¹æ¯”] [è¯¦æƒ…]                        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ v1.0 - 2025-12-22 09:00 (åˆå§‹éƒ¨ç½²)         â”‚ â”‚
â”‚ â”‚   Paper æ¨¡å¼éƒ¨ç½²                              â”‚ â”‚
â”‚ â”‚   [å›æ»š] [å¯¹æ¯”] [è¯¦æƒ…]                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰ˆæœ¬å¯¹æ¯” (v2.1 vs v2.0)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‚æ•°å·®å¼‚å¯¹æ¯”                                      â”‚
â”‚                                                 â”‚
â”‚ æ­¢æŸç™¾åˆ†æ¯”                                        â”‚
â”‚   v2.0: 3%                                      â”‚
â”‚   v2.1: 5% ğŸ”º +2%                              â”‚
â”‚                                                 â”‚
â”‚ æ­¢ç›ˆç™¾åˆ†æ¯” (æ— å˜åŒ–)                               â”‚
â”‚   v2.0: 15%                                     â”‚
â”‚   v2.1: 15%                                     â”‚
â”‚                                                 â”‚
â”‚ æŒä»“æ•°é‡ (æ— å˜åŒ–)                                 â”‚
â”‚   v2.0: 0.5 BTC                                 â”‚
â”‚   v2.1: 0.5 BTC                                 â”‚
â”‚                                                 â”‚
â”‚                                  [å…³é—­] [å›æ»šåˆ° v2.0] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æˆåŠŸæ ‡å‡†

1. âœ… MonitorCanvas æ‰©å±•åŒ…å«"å‚æ•°è°ƒæ•´"å’Œ"å¹²é¢„å†å²"æ ‡ç­¾é¡µ
2. âœ… æ”¯æŒå®æ—¶ä¿®æ”¹ç­–ç•¥å‚æ•°å¹¶éªŒè¯
3. âœ… ç´§æ€¥æ“ä½œæŒ‰é’®å¯æ­£å¸¸æ‰§è¡Œ
4. âœ… å¹²é¢„å†å²å®Œæ•´è®°å½•å¹¶å¯å¯¼å‡º
5. âœ… ç‰ˆæœ¬å†å²åˆ—è¡¨æ­£ç¡®å±•ç¤º
6. âœ… ç‰ˆæœ¬å›æ»šåŠŸèƒ½æ­£å¸¸,å«äºŒæ¬¡ç¡®è®¤
7. âœ… ç‰ˆæœ¬å¯¹æ¯” Diff æ­£ç¡®æ˜¾ç¤ºå‚æ•°å·®å¼‚

---

## Stories

### Story 9.1: InterventionPanel å‚æ•°è°ƒæ•´é¢æ¿

**æ ‡é¢˜**: åˆ›å»ºç­–ç•¥å‚æ•°å®æ—¶è°ƒæ•´é¢æ¿

**æè¿°**:
åœ¨ MonitorCanvas ä¸­æ–°å¢"å‚æ•°è°ƒæ•´"æ ‡ç­¾é¡µ,æ”¯æŒå®æ—¶ä¿®æ”¹è¿è¡Œä¸­ç­–ç•¥çš„å‚æ•°ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰©å±• MonitorCanvas,æ·»åŠ "å‚æ•°è°ƒæ•´"æ ‡ç­¾é¡µ
- [ ] å¤ç”¨ `ParamControl` ç»„ä»¶å±•ç¤ºå¯è°ƒå‚æ•°
- [ ] æ˜¾ç¤ºå‚æ•°åŸå€¼å’Œå½“å‰å€¼å¯¹æ¯”
- [ ] é›†æˆ `useParamConstraints` è¿›è¡ŒéªŒè¯
- [ ] æä¾›"é‡ç½®"ã€"é¢„è§ˆå½±å“"ã€"åº”ç”¨ä¿®æ”¹"æŒ‰é’®
- [ ] å‚æ•°ä¿®æ”¹åè°ƒç”¨ API å¹¶æ›´æ–°ç­–ç•¥çŠ¶æ€
- [ ] å‚æ•°ä¿®æ”¹è®°å½•åˆ°å¹²é¢„å†å²

**æŠ€æœ¯è®¾è®¡**:
```typescript
// components/intervention/InterventionPanel.tsx
interface InterventionPanelProps {
  agentId: string
  currentParams: InsightParam[]
  onParamsUpdate: (params: InsightParam[]) => Promise<void>
  onEmergencyAction: (action: EmergencyAction) => Promise<void>
}

type EmergencyAction =
  | 'close_all_positions'     // å¹³ä»“æ‰€æœ‰æŒä»“
  | 'disable_new_positions'   // ç¦ç”¨æ–°å¼€ä»“
  | 'restart_strategy'        // é‡å¯ç­–ç•¥
  | 'pause_strategy'          // æš‚åœç­–ç•¥
```

---

### Story 9.2: ç´§æ€¥æ“ä½œä¸å¹²é¢„å†å²

**æ ‡é¢˜**: å®ç°ç´§æ€¥æ“ä½œæŒ‰é’®å’Œå¹²é¢„å†å²è®°å½•

**æè¿°**:
æ·»åŠ ç´§æ€¥æ“ä½œæ‰§è¡Œé€»è¾‘,è®°å½•æ‰€æœ‰äººå·¥å¹²é¢„æ“ä½œåˆ°å†å²æ—¥å¿—ã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] å®ç° 4 ä¸ªç´§æ€¥æ“ä½œæŒ‰é’® (å¹³ä»“/ç¦ç”¨å¼€ä»“/é‡å¯/æš‚åœ)
- [ ] ç´§æ€¥æ“ä½œéœ€äºŒæ¬¡ç¡®è®¤ (å±é™©æ“ä½œç”¨ Dialog)
- [ ] åˆ›å»º `store/intervention.ts` ç®¡ç†å¹²é¢„è®°å½•
- [ ] å¹²é¢„å†å²å±•ç¤ºæœ€è¿‘ 20 æ¡è®°å½•
- [ ] æ”¯æŒå¯¼å‡ºå¹²é¢„æ—¥å¿—ä¸º CSV
- [ ] å¹²é¢„è®°å½•åŒ…å«: æ—¶é—´æˆ³ã€æ“ä½œç±»å‹ã€æ“ä½œå‰åçŠ¶æ€ã€åŸå›  (å¯é€‰)
- [ ] API æ¥å£: `POST /api/agents/:id/emergency`, `GET /api/agents/:id/interventions`

**æŠ€æœ¯è®¾è®¡**:
```typescript
// types/intervention.ts
export interface InterventionRecord {
  id: string
  agentId: string
  timestamp: number
  type: 'param_change' | 'emergency_action'
  action?: EmergencyAction
  paramChanges?: {
    key: string
    oldValue: unknown
    newValue: unknown
  }[]
  reason?: string
  operator: string // ç”¨æˆ· ID æˆ–åç§°
}

// store/intervention.ts
interface InterventionState {
  records: Map<string, InterventionRecord[]> // agentId -> records
  addRecord: (record: InterventionRecord) => void
  getRecordsByAgent: (agentId: string) => InterventionRecord[]
  exportRecords: (agentId: string) => void
}
```

---

### Story 9.3: ç‰ˆæœ¬å†å²ä¸å›æ»šç³»ç»Ÿ

**æ ‡é¢˜**: å®ç°ç­–ç•¥ç‰ˆæœ¬ç®¡ç†å’Œä¸€é”®å›æ»š

**æè¿°**:
åˆ›å»ºç‰ˆæœ¬å†å²ç³»ç»Ÿ,æ”¯æŒç­–ç•¥å¿«ç…§ã€ç‰ˆæœ¬å¯¹æ¯”å’Œå›æ»šã€‚

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ›å»º `VersionHistoryCanvas.tsx` ç‰ˆæœ¬å†å²é¢æ¿
- [ ] åˆ›å»º `store/version.ts` ç®¡ç†ç‰ˆæœ¬æ•°æ®
- [ ] æ˜¾ç¤ºç‰ˆæœ¬åˆ—è¡¨ (ç‰ˆæœ¬å·ã€æ—¶é—´ã€ä¿®æ”¹æ‘˜è¦)
- [ ] å®ç°ç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½ (å¹¶æ’ Diff)
- [ ] å®ç°ä¸€é”®å›æ»š (å«äºŒæ¬¡ç¡®è®¤)
- [ ] å›æ»šæ“ä½œè®°å½•ä¸ºæ–°ç‰ˆæœ¬
- [ ] ç‰ˆæœ¬å·è‡ªåŠ¨ç”Ÿæˆè§„åˆ™: å‚æ•°å¾®è°ƒ +0.1, é‡å¤§ä¿®æ”¹ +1.0
- [ ] æ”¯æŒæ‰‹åŠ¨åˆ›å»ºç‰ˆæœ¬å¿«ç…§ (å¸¦å¤‡æ³¨)
- [ ] API æ¥å£: `GET /api/strategies/:id/versions`, `POST /api/strategies/:id/rollback`

**æŠ€æœ¯è®¾è®¡**:
```typescript
// types/version.ts
export interface StrategyVersion {
  id: string
  strategyId: string
  version: string // 'v1.0', 'v1.1', 'v2.0'
  timestamp: number
  params: InsightParam[]
  summary: string // ä¿®æ”¹æ‘˜è¦
  reason?: string // åˆ›å»ºåŸå› 
  isActive: boolean
  createdBy: 'user' | 'system' // æ‰‹åŠ¨å¿«ç…§ vs è‡ªåŠ¨å¿«ç…§
}

// components/canvas/VersionHistoryCanvas.tsx
interface VersionHistoryCanvasProps {
  strategyId: string
  isOpen: boolean
  onClose: () => void
  onRollback: (versionId: string) => Promise<void>
}

// components/version/VersionCompare.tsx
interface VersionCompareProps {
  version1: StrategyVersion
  version2: StrategyVersion
  onClose: () => void
}
```

---

## å…¼å®¹æ€§è¦æ±‚

- [ ] MonitorCanvas ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- [ ] CanvasPanel å‚æ•°ç¼–è¾‘æœºåˆ¶ä¿æŒå‘åå…¼å®¹
- [ ] API æ‰©å±•ä¸ç ´åç°æœ‰ç«¯ç‚¹
- [ ] ç‰ˆæœ¬ç³»ç»Ÿä¸å½±å“ç°æœ‰éƒ¨ç½²æµç¨‹
- [ ] å¹²é¢„è®°å½•ä¸å½±å“æ€§èƒ½ (å¼‚æ­¥è®°å½•)

---

## é£é™©ç¼“è§£

### ä¸»è¦é£é™©
**å®æ—¶å‚æ•°ä¿®æ”¹å¯èƒ½å¯¼è‡´ç­–ç•¥è¡Œä¸ºå¼‚å¸¸,é€ æˆéé¢„æœŸæŸå¤±**

### ç¼“è§£æªæ–½
1. **å‚æ•°éªŒè¯** - å¤ç”¨ `useParamConstraints` å¼ºåˆ¶æ ¡éªŒ
2. **äºŒæ¬¡ç¡®è®¤** - å…³é”®æ“ä½œ (å¹³ä»“ã€é‡å¯) éœ€ç¡®è®¤
3. **é¢„è§ˆå½±å“** - ä¿®æ”¹å‰å±•ç¤ºé¢„æœŸå½±å“ (å¦‚å¯èƒ½è§¦å‘æ­¢æŸ)
4. **å¹²é¢„æ—¥å¿—** - å®Œæ•´è®°å½•ä¾¿äºäº‹åå®¡è®¡
5. **ç‰ˆæœ¬å›æ»š** - æ”¯æŒå¿«é€Ÿæ¢å¤åˆ°ç¨³å®šç‰ˆæœ¬

### å›æ»šè®¡åˆ’
1. å‚æ•°ä¿®æ”¹å¯ç«‹å³å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
2. ç´§æ€¥æ“ä½œä¸å¯å›æ»š (å¦‚å¹³ä»“å·²æ‰§è¡Œ),ä½†å¯é‡å¯ç­–ç•¥
3. ç‰ˆæœ¬å†å²ä¿ç•™è‡³å°‘ 30 å¤©,æ”¯æŒè¿½æº¯

---

## Definition of Done

- [ ] æ‰€æœ‰ 3 ä¸ª Stories å®Œæˆå¹¶é€šè¿‡éªŒæ”¶
- [ ] MonitorCanvas å‚æ•°è°ƒæ•´åŠŸèƒ½æ­£å¸¸
- [ ] ç´§æ€¥æ“ä½œæŒ‰é’®å¯æ­£å¸¸æ‰§è¡Œ
- [ ] å¹²é¢„å†å²è®°å½•å®Œæ•´ä¸”å¯å¯¼å‡º
- [ ] ç‰ˆæœ¬å†å²åˆ—è¡¨æ­£ç¡®å±•ç¤º
- [ ] ç‰ˆæœ¬å›æ»šåŠŸèƒ½æ­£å¸¸
- [ ] ç‰ˆæœ¬å¯¹æ¯” Diff æ­£ç¡®
- [ ] ç°æœ‰ç›‘æ§ã€éƒ¨ç½²åŠŸèƒ½å›å½’æµ‹è¯•é€šè¿‡
- [ ] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] ç”Ÿäº§æ„å»ºé€šè¿‡
- [ ] æ—  P0/P1 çº§åˆ« Bug

---

## æ–‡ä»¶è·¯å¾„

| æ–‡ä»¶ | è·¯å¾„ | æ“ä½œ |
|------|------|------|
| InterventionPanel | `components/intervention/InterventionPanel.tsx` | åˆ›å»º |
| InterventionHistory | `components/intervention/InterventionHistory.tsx` | åˆ›å»º |
| EmergencyActions | `components/intervention/EmergencyActions.tsx` | åˆ›å»º |
| VersionHistoryCanvas | `components/canvas/VersionHistoryCanvas.tsx` | åˆ›å»º |
| VersionCompare | `components/version/VersionCompare.tsx` | åˆ›å»º |
| VersionList | `components/version/VersionList.tsx` | åˆ›å»º |
| InterventionStore | `store/intervention.ts` | åˆ›å»º |
| VersionStore | `store/version.ts` | åˆ›å»º |
| InterventionTypes | `types/intervention.ts` | åˆ›å»º |
| VersionTypes | `types/version.ts` | åˆ›å»º |
| MonitorCanvas | `components/canvas/MonitorCanvas.tsx` | ä¿®æ”¹ (æ·»åŠ æ ‡ç­¾é¡µ) |
| API Client | `lib/api.ts` | ä¿®æ”¹ (æ·»åŠ æ¥å£) |

---

## éªŒè¯æ¸…å•

### èŒƒå›´éªŒè¯
- [x] Epic å¯åœ¨ 3 ä¸ª Stories å†…å®Œæˆ
- [x] æ— éœ€æ¶æ„å±‚é¢å˜æ›´
- [x] éµå¾ªç°æœ‰ Canvas/A2UI æ¨¡å¼
- [x] é›†æˆå¤æ‚åº¦å¯æ§

### é£é™©è¯„ä¼°
- [x] å¯¹ç°æœ‰ç³»ç»Ÿé£é™©: ä½ (æ‰©å±•ç°æœ‰ç»„ä»¶)
- [x] å›æ»šæ–¹æ¡ˆå¯è¡Œ
- [x] å‚æ•°éªŒè¯æœºåˆ¶å·²å­˜åœ¨
- [x] å›¢é˜Ÿç†Ÿæ‚‰ Canvas å’Œ Store æ¨¡å¼

### å®Œæ•´æ€§æ£€æŸ¥
- [x] Epic ç›®æ ‡æ¸…æ™°å¯å®ç°
- [x] Stories èŒƒå›´åˆç†
- [x] æˆåŠŸæ ‡å‡†å¯è¡¡é‡
- [x] ä¾èµ–å·²è¯†åˆ« (EPIC-001, EPIC-003)

---

## Story Manager ç§»äº¤

**Story Manager ç§»äº¤è¯´æ˜:**

è¯·ä¸ºæ­¤ Brownfield Epic å¼€å‘è¯¦ç»†çš„ç”¨æˆ·æ•…äº‹ã€‚å…³é”®è€ƒè™‘äº‹é¡¹:

- è¿™æ˜¯å¯¹è¿è¡Œ **Next.js 15 + React 19 + Zustand** çš„ç°æœ‰ç³»ç»Ÿçš„å¢å¼º
- **é›†æˆç‚¹**:
  - MonitorCanvas æ‰©å±• (æ·»åŠ æ ‡ç­¾é¡µ)
  - CanvasPanel å‚æ•°ç¼–è¾‘æœºåˆ¶å¤ç”¨
  - API å®¢æˆ·ç«¯æ‰©å±• (å¹²é¢„å’Œç‰ˆæœ¬æ¥å£)
- **éœ€éµå¾ªçš„ç°æœ‰æ¨¡å¼**:
  - Canvas æ»‘å‡ºäº¤äº’ (å‚è€ƒ `CanvasPanel.tsx`, `MonitorCanvas.tsx`)
  - A2UI æ§ä»¶ä½¿ç”¨ (`ParamControl`, `useParamConstraints`)
  - RiverBit Design System æ ·å¼
- **å…³é”®å…¼å®¹æ€§è¦æ±‚**:
  - ç°æœ‰ç›‘æ§ã€éƒ¨ç½²åŠŸèƒ½ä¸å—å½±å“
  - å‚æ•°éªŒè¯æœºåˆ¶ä¿æŒä¸€è‡´
  - å¹²é¢„æ“ä½œéœ€äºŒæ¬¡ç¡®è®¤
- æ¯ä¸ª Story å¿…é¡»åŒ…å«éªŒè¯ç°æœ‰åŠŸèƒ½ä¿æŒå®Œæ•´çš„æµ‹è¯•

Epic ç›®æ ‡: **èµ‹äºˆç”¨æˆ·ç²¾ç»†æ§åˆ¶ç­–ç•¥çš„èƒ½åŠ›,åŒæ—¶ä¿éšœæ“ä½œå®‰å…¨æ€§å’Œå¯è¿½æº¯æ€§**

---

**åˆ›å»ºæ—¶é—´**: 2025-12-26
**åˆ›å»ºè€…**: BMad Analyst Agent
**æ¥æº**: PRD S24, S25 åœºæ™¯åˆ†æ
