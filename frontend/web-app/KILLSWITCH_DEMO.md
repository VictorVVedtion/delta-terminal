# Kill Switch ç»„ä»¶æ¼”ç¤ºæŒ‡å—

## å¿«é€Ÿé¢„è§ˆ

Kill Switch ç´§æ€¥åœæ­¢æŒ‰é’®ç°å·²é›†æˆåˆ° Header ç»„ä»¶ä¸­ï¼Œä½äºé¡¶éƒ¨çŠ¶æ€æ çš„å³ä¾§åŒºåŸŸã€‚

## è§†è§‰æ•ˆæœ

### æ¡Œé¢ç«¯æ˜¾ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Delta Terminal    [æœç´¢æ¡†]              [å®æ—¶] [ğŸ”´ç´§æ€¥åœæ­¢] [ğŸ””] [âš™ï¸] [ğŸ‘¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç§»åŠ¨ç«¯æ˜¾ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DT  [æœç´¢]  [ğŸ”´] [ğŸ””] [ğŸ‘¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äº¤äº’æµç¨‹

### 1. åˆå§‹çŠ¶æ€
- æŒ‰é’®æ˜¾ç¤ºçº¢è‰²æ–‡å­—"ç´§æ€¥åœæ­¢"ï¼ˆæ¡Œé¢ç«¯ï¼‰æˆ–ç”µæºå›¾æ ‡ï¼ˆç§»åŠ¨ç«¯ï¼‰
- ä½¿ç”¨ `ghost` å˜ä½“ï¼Œé¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºçº¢è‰²èƒŒæ™¯é«˜äº®

### 2. ç‚¹å‡»è§¦å‘
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åï¼Œå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  ç¡®è®¤ç´§æ€¥åœæ­¢?                  â•‘
â•‘                                   â•‘
â•‘  æ­¤æ“ä½œå°†ç«‹å³æ‰§è¡Œä»¥ä¸‹åŠ¨ä½œ:          â•‘
â•‘  â€¢ å–æ¶ˆæ‰€æœ‰æŒ‚å•                    â•‘
â•‘  â€¢ å¹³æ‰€æœ‰æŒä»“ (å¸‚ä»·å•)              â•‘
â•‘  â€¢ æš‚åœæ‰€æœ‰è¿è¡Œä¸­çš„ç­–ç•¥             â•‘
â•‘  â€¢ è®°å½•æ“ä½œæ—¥å¿—                    â•‘
â•‘                                   â•‘
â•‘  æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…æ“ä½œã€‚        â•‘
â•‘                                   â•‘
â•‘  [å–æ¶ˆ]         [ç¡®è®¤æ‰§è¡Œ]          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3. ç¡®è®¤æ‰§è¡Œ
ç‚¹å‡»"ç¡®è®¤æ‰§è¡Œ"åï¼š

- æŒ‰é’®å˜ä¸ºç¦ç”¨çŠ¶æ€
- æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼š"âš™ï¸ æ‰§è¡Œä¸­..."
- èƒŒæ™¯æ‰§è¡Œç´§æ€¥åœæ­¢æ“ä½œ

### 4. å®ŒæˆçŠ¶æ€
- å¯¹è¯æ¡†è‡ªåŠ¨å…³é—­
- æŒ‰é’®æ¢å¤å¯ç”¨çŠ¶æ€
- æ§åˆ¶å°è¾“å‡ºæ“ä½œæ—¥å¿—

## ä»£ç ç¤ºä¾‹

### åœ¨ Header ä¸­ä½¿ç”¨
```tsx
// src/components/layout/Header.tsx
import { KillSwitch } from '@/components/KillSwitch'

export function Header() {
  return (
    <header>
      {/* ... å…¶ä»–å†…å®¹ ... */}
      <KillSwitch />
      {/* ... */}
    </header>
  )
}
```

### ç‹¬ç«‹ä½¿ç”¨
```tsx
import { KillSwitch } from '@/components/KillSwitch'

function EmergencyPanel() {
  return (
    <div className="emergency-controls">
      <h3>ç´§æ€¥æ§åˆ¶</h3>
      <KillSwitch />
    </div>
  )
}
```

## æ ·å¼å®šåˆ¶

### ä¿®æ”¹æŒ‰é’®é¢œè‰²
```tsx
// KillSwitch.tsx
<Button
  variant="ghost"
  size="sm"
  className="gap-2 text-yellow-500 hover:bg-yellow-500/10" // æ”¹ä¸ºé»„è‰²
>
```

### ä¿®æ”¹å¯¹è¯æ¡†å®½åº¦
```tsx
<AlertDialogContent className="max-w-lg"> // ä» max-w-md æ”¹ä¸º max-w-lg
```

### è‡ªå®šä¹‰å›¾æ ‡
```tsx
import { AlertTriangle } from 'lucide-react' // æ›¿æ¢ Power

<AlertTriangle className="h-4 w-4" />
```

## API ç«¯ç‚¹è¦æ±‚

### åç«¯éœ€å®ç°ä»¥ä¸‹ç«¯ç‚¹

#### 1. å–æ¶ˆæ‰€æœ‰è®¢å•
```typescript
POST /orders/cancel-all
Response: {
  cancelledCount: number
}
```

#### 2. å¹³æ‰€æœ‰æŒä»“
```typescript
POST /portfolio/positions/close-all
Response: {
  closedCount: number
}
```

#### 3. è·å–æŒä»“åˆ—è¡¨
```typescript
GET /portfolio/positions
Response: Position[]
```

#### 4. è®°å½•äº‹ä»¶æ—¥å¿—
```typescript
POST /system/killswitch-log
Body: {
  timestamp: string
  cancelledOrders: number
  closedPositions: number
  stoppedStrategies: number
}
Response: {
  success: boolean
}
```

## æµ‹è¯•æ–¹æ¡ˆ

### æ‰‹åŠ¨æµ‹è¯•
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨: `pnpm dev`
2. è®¿é—® `http://localhost:3000/dashboard`
3. ç‚¹å‡» Header å³ä¾§çš„"ç´§æ€¥åœæ­¢"æŒ‰é’®
4. éªŒè¯ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤º
5. ç‚¹å‡»"ç¡®è®¤æ‰§è¡Œ"
6. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—è¾“å‡º

### æ§åˆ¶å°é¢„æœŸè¾“å‡º
```
[KillSwitch] å–æ¶ˆæ‰€æœ‰æŒ‚å•...
[KillSwitch] å¹³æ‰€æœ‰æŒä»“...
[KillSwitch] æš‚åœæ‰€æœ‰ç­–ç•¥...
[KillSwitch] è®°å½•æ“ä½œæ—¥å¿—...
[KillSwitch] ç´§æ€¥åœæ­¢å®Œæˆ
```

### é”™è¯¯å¤„ç†æµ‹è¯•
å¦‚æœåç«¯ API æœªå®ç°ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š
```
[KillSwitch] æ‰§è¡Œå¤±è´¥: Error: API Error: Not Found
```

## å¸¸è§é—®é¢˜

### Q: æŒ‰é’®ä¸æ˜¾ç¤ºï¼Ÿ
A: æ£€æŸ¥ Header ç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥ `KillSwitch`ï¼š
```tsx
import { KillSwitch } from '@/components/KillSwitch'
```

### Q: ç‚¹å‡»æŒ‰é’®æ— ååº”ï¼Ÿ
A: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯ï¼Œç¡®è®¤ä¾èµ–å·²å®‰è£…ï¼š
```bash
pnpm install @radix-ui/react-alert-dialog
```

### Q: ç±»å‹é”™è¯¯ï¼Ÿ
A: è¿è¡Œç±»å‹æ£€æŸ¥ï¼š
```bash
pnpm type-check
```

### Q: æ ·å¼ä¸æ­£ç¡®ï¼Ÿ
A: ç¡®è®¤ `globals.css` ä¸­ `--destructive` å˜é‡å·²å®šä¹‰ï¼š
```css
.dark {
  --destructive: 358 78% 55%; /* #DD3C41 */
}
```

## æ€§èƒ½æŒ‡æ ‡

- **ç»„ä»¶å¤§å°**: ~3KB (æœªå‹ç¼©)
- **é¦–æ¬¡æ¸²æŸ“**: < 50ms
- **å¯¹è¯æ¡†æ‰“å¼€**: < 100ms (åŠ¨ç”»æ—¶é—´)
- **API è°ƒç”¨**: å¹¶è¡Œæ‰§è¡Œï¼Œå–å†³äºç½‘ç»œå»¶è¿Ÿ

## å¯è®¿é—®æ€§

### é”®ç›˜å¯¼èˆª
- `Tab`: èšç„¦åˆ°æŒ‰é’®
- `Enter` / `Space`: æ‰“å¼€å¯¹è¯æ¡†
- `Tab`: åœ¨å¯¹è¯æ¡†å†…åˆ‡æ¢æŒ‰é’®
- `Esc`: å…³é—­å¯¹è¯æ¡†

### å±å¹•é˜…è¯»å™¨
- æŒ‰é’®æ ‡ç­¾: "ç´§æ€¥å…¨å±€åœæ­¢"
- å¯¹è¯æ¡†æ ‡é¢˜: "ç¡®è®¤ç´§æ€¥åœæ­¢?"
- æ“ä½œåˆ—è¡¨: å¯è¢«å±å¹•é˜…è¯»å™¨è¯†åˆ«

## ä¸‹ä¸€æ­¥

1. **é›†æˆ Toast é€šçŸ¥**
   ```tsx
   import { toast } from '@/components/ui/toast'

   toast.success('ç´§æ€¥åœæ­¢å·²æ‰§è¡Œ')
   toast.error('æ‰§è¡Œå¤±è´¥ï¼Œè¯·é‡è¯•')
   ```

2. **æ·»åŠ æƒé™æ§åˆ¶**
   ```tsx
   const { hasPermission } = useAuth()

   {hasPermission('emergency.killswitch') && <KillSwitch />}
   ```

3. **å®ç°æ“ä½œæ—¥å¿—æŸ¥è¯¢**
   ```tsx
   // æ–°é¡µé¢: /logs/killswitch
   import { KillSwitchLogs } from '@/components/logs/KillSwitchLogs'
   ```

4. **æ·»åŠ å¿«æ·é”®**
   ```tsx
   useEffect(() => {
     const handleKeyPress = (e: KeyboardEvent) => {
       if (e.ctrlKey && e.shiftKey && e.key === 'K') {
         setIsOpen(true)
       }
     }
     window.addEventListener('keydown', handleKeyPress)
     return () => window.removeEventListener('keydown', handleKeyPress)
   }, [])
   ```

## ç›¸å…³èµ„æº

- **ç»„ä»¶æ–‡ä»¶**: `/src/components/KillSwitch.tsx`
- **å®ç°æ–‡æ¡£**: `KILLSWITCH_IMPLEMENTATION.md`
- **API æ–‡æ¡£**: `/src/lib/api.ts`
- **è®¾è®¡ç³»ç»Ÿ**: `/src/app/globals.css`

---

**åˆ›å»ºæ—¶é—´**: 2025-12-25
**ç‰ˆæœ¬**: 1.0.0
**ä½œè€…**: Delta Terminal å¼€å‘å›¢é˜Ÿ
